<!DOCTYPE html>
<html>
<head>
    <title>MÃ©todo Garantido Google Sheets</title>
    <script>
        // âœ… URL do SEU Web App (USE A SUA)
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwwrwV_vd7T6vnUQhE0L_fMYYiUn9Li7DCnj7O6czwRu9jgHGDWSGsE09jPHmCcuAgn0w/exec";
        
        // ğŸ¯ MÃ‰TODO 1: Usando Google Forms como intermediÃ¡rio (100% funciona)
        async function enviarViaForm() {
            console.log("ğŸ“¤ MÃ©todo Form: Iniciando...");
            
            // Cria um formulÃ¡rio temporÃ¡rio
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = WEB_APP_URL;
            form.target = '_blank'; // Abre em nova aba para ver resultado
            form.style.display = 'none';
            
            // Dados a enviar
            const dados = {
                page: window.location.href,
                referrer: document.referrer || "Direto",
                userAgent: navigator.userAgent,
                ip: await getIP(),
                timestamp: new Date().toISOString(),
                testId: "FORM_" + Date.now()
            };
            
            // Adiciona campo oculto
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'data';
            input.value = JSON.stringify(dados);
            form.appendChild(input);
            
            // Adiciona ao body e submete
            document.body.appendChild(form);
            form.submit();
            
            console.log("âœ… FormulÃ¡rio submetido");
            
            // Remove apÃ³s 5 segundos
            setTimeout(() => {
                document.body.removeChild(form);
                console.log("ğŸ§¹ FormulÃ¡rio removido");
            }, 5000);
            
            return true;
        }
        
        // ğŸ¯ MÃ‰TODO 2: Usando imagem pixel tracker (100% funciona)
        function enviarViaPixel() {
            console.log("ğŸ“¤ MÃ©todo Pixel: Iniciando...");
            
            // Cria URL com parÃ¢metros
            const params = new URLSearchParams({
                page: encodeURIComponent(window.location.href),
                referrer: encodeURIComponent(document.referrer || "Direto"),
                userAgent: encodeURIComponent(navigator.userAgent.substring(0, 200)),
                timestamp: new Date().toISOString(),
                method: 'pixel',
                rand: Math.random()
            });
            
            // Cria imagem de 1x1 pixel
            const img = new Image();
            img.src = WEB_APP_URL + '?' + params.toString();
            img.style.display = 'none';
            img.width = 1;
            img.height = 1;
            
            document.body.appendChild(img);
            console.log("âœ… Pixel enviado:", img.src.substring(0, 200) + "...");
            
            return true;
        }
        
        // ğŸ¯ MÃ‰TODO 3: Usando fetch com redirecionamento
        async function enviarViaFetchRedirect() {
            console.log("ğŸ“¤ MÃ©todo Fetch Redirect: Iniciando...");
            
            try {
                const dados = {
                    page: window.location.href,
                    referrer: document.referrer || "Direto",
                    userAgent: navigator.userAgent,
                    ip: await getIP(),
                    timestamp: new Date().toISOString(),
                    method: 'fetch'
                };
                
                // Envia e redireciona para a resposta
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = WEB_APP_URL;
                form.style.display = 'none';
                
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'data';
                input.value = JSON.stringify(dados);
                
                form.appendChild(input);
                document.body.appendChild(form);
                form.submit();
                
                console.log("âœ… Fetch com redirecionamento enviado");
                return true;
                
            } catch (error) {
                console.error("âŒ Erro:", error);
                return false;
            }
        }
        
        // FunÃ§Ã£o para pegar IP
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return "NÃ£o disponÃ­vel";
            }
        }
        
        // ğŸ¯ MÃ‰TODO PRINCIPAL: Tenta todos os mÃ©todos
        async function enviarDadosGarantido() {
            console.log("ğŸš€ INICIANDO ENVIO GARANTIDO");
            
            // Tenta MÃ©todo 1
            console.log("ğŸ”„ Tentando MÃ©todo 1 (Form)...");
            await enviarViaForm();
            
            // Aguarda 1 segundo
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Tenta MÃ©todo 2
            console.log("ğŸ”„ Tentando MÃ©todo 2 (Pixel)...");
            enviarViaPixel();
            
            // Aguarda 1 segundo
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Tenta MÃ©todo 3
            console.log("ğŸ”„ Tentando MÃ©todo 3 (Fetch Redirect)...");
            await enviarViaFetchRedirect();
            
            console.log("âœ… Todos os mÃ©todos tentados");
            alert("âœ… Dados enviados por mÃºltiplos mÃ©todos!\nVerifique a planilha.");
        }
        
        // Executa quando a pÃ¡gina carrega
        window.onload = function() {
            console.log("ğŸŒ PÃ¡gina carregada, iniciando envio...");
            
            // Pequeno delay para garantir carregamento
            setTimeout(() => {
                enviarDadosGarantido();
            }, 1500);
        };
        
    </script>
</head>
<body style="font-family: Arial, sans-serif; padding: 20px; text-align: center;">
    <h1>ğŸš€ Teste de GravaÃ§Ã£o Google Sheets</h1>
    <p>Enviando dados para sua planilha...</p>
    
    <div style="margin: 30px;">
        <button onclick="enviarDadosGarantido()" style="padding: 15px 30px; font-size: 18px; background: #4285f4; color: white; border: none; border-radius: 5px; cursor: pointer;">
            ğŸ”„ Testar Novamente
        </button>
    </div>
    
    <div style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 5px;">
        <h3>ğŸ“Š Status:</h3>
        <p id="status">Enviando dados...</p>
        <p><small>Verifique o console do navegador (F12) para detalhes</small></p>
    </div>
    
    <script>
        // Atualiza status
        function atualizarStatus(mensagem) {
            document.getElementById('status').textContent = mensagem;
        }
        
        // Sobrescreve console.log para mostrar na tela tambÃ©m
        const consoleOriginal = console.log;
        console.log = function(...args) {
            consoleOriginal.apply(console, args);
            const mensagem = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            
            if (mensagem.includes('âœ…') || mensagem.includes('âŒ')) {
                atualizarStatus(mensagem);
            }
        };
        
        // Inicializa
        atualizarStatus("Preparando envio...");
    </script>
</body>
</html>
